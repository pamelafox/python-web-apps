
<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Databases & ORMS</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reset.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/simple.css" id="theme">
        <link rel="stylesheet" href="../static/a11y-dark.min.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:300,400,500|Work+Sans:400,700">
        <link rel="stylesheet" href="../static/slides.css">
	</head>
    <body>
    <div class="reveal">
        <div class="slides">

            <section class="heading-only" style="padding-top:5%">
                <h1 style="font-size:120px">Python Web Apps:<br>
                    Databases & ORMs</h1>

                <h2><a target="_blank" class="aka" href="https://aka.ms/python-web-apps-dbs">
                    aka.ms/python-web-apps-dbs</a>
                </h2>

                <div class="no-print" style="text-align: left; margin-top: 100px; font-size: 70%; display:none;">
                    Tips for navigating the slides:
                    <ul>
                        <li>Press O or Escape for overview mode.</li>
                        <li>Visit <a href="?print-pdf" target="_blank">this link</a> for a nice printable version</li>
                        <li>Press the copy icon on the upper right of code blocks to copy the code</li>
                    </ul>
                </div>

                <aside class="speaker-notes">
                </aside>
            </section>


            <section>
                <h3>Meet Pamela</h3>
                
                <img src="https://pamelafox.github.io/my-py-talks/configure-vscode/photo_pamela_olaf.jpg" alt="Photo of Pamela smiling with an Olaf statue" style="float:right; height:400px;">
                <p>Python Cloud Advocate at Microsoft</p>
                <p>Formerly: UC Berkeley, Coursera, Khan Academy, Google</p>
                <br>
                <p>Find Pamela online at:</p>
                <table style="width:40%; float: left; font-size:28px;">
                    <tr>
                      <td>Mastodon
                      <td><a target="_blank" href="https://fosstodon.org/@pamelafox">@pamelafox@fosstodon.org</a></td>
                    </tr>
                    <tr>
                        <td>Twitter
                        <td><a target="_blank" href="https://twitter.com/pamelafox">@pamelafox</a></td>
                      </tr>
                    <tr>
                        <td>GitHub
                        <td><a target="_blank" href="https://www.github.com/pamelafox">www.github.com/pamelafox</a></td>
                      </tr>
                    <tr>
                        <td>Website
                        <td><a target="_blank" href="https://www.pamelafox.org">pamelafox.org</a></td>
                      </tr>
                  </table>
            </section>


            <section>
                <h3>Today's topics</h3>

                <img src="../static/images/BIT_PUBLIC_SPEAKING.svg" alt="Bit (the raccoon) lecturing" width="200" style="float:right;">
                <ul style="margin-top:20px; font-size:44px; line-height: 1.5em; float:left; width:800px;">
                    <li>Databases
                        <ul style="font-size:0.6em">
                            <li style="line-height:1em;">üë©üèæ‚Äçüíª Exercise: PostgreSQL Playground
                        </ul>
                    <li>Using databases from Python
                        <ul style="font-size:0.6em">
                            <li style="line-height:1em;">üë©üèº‚Äçüíª Exercise: PostgreSQL Playground Part 2
                        </ul>
                    <li>Using Flask with databases
                        <ul style="font-size:0.6em">
                            <li style="line-height:1em;">üë©üèª‚Äçüíª Exercise: Example Flask + DB app
                        </ul>
                    <li>Deploying web apps and databases
                        <ul style="font-size:0.6em">
                            <li style="line-height:1em;">üßëüèø‚Äçüíª Exercise: Deploying PostgreSQL
                            <li style="line-height:1em;">üë®üèª‚Äçüíª Exercise: Deploying Flask+PG app
                        </ul>
                </ul>
            </section>

            <section>
                <h3>Exercise tools</h3>

                <p>To follow along with the exercises, you can do either:</p>
                <ol>
                    <li>Online development with Codespaces: 
                        <ul>
                            <li><a target="_blank" href="https://github.com/signup">Github account</a>
                            </ul>
                    <li class="padded">Local development with VS Code:
                    <ul>
                        <li><a target="_blank" href="https://code.visualstudio.com/Download">Visual Studio Code</a></li>
                        <li><a target="_blank" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Dev Containers extension</a></li>
                        <li><a target="_blank" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a></li>
                    </ul>

                    <li class="padded">Local development with any editor:
                    <ul>
                        <li>Code editor</li>
                        <li><a target="_blank" href="https://www.python.org/downloads/">Python 3</a></li>
                        <li><a target="_blank" href="https://www.postgresql.org/download/">PostgreSQL</a></li>
                    </ul>
                </ol>
            </section>

            <section class="heading-only">
                <h2>Databases & ORMs</h2>

                <img src="../static/images/DATA_BIT.svg" alt="Bit (the raccoon) with 0s and 1s behind" width="400">
            </section>

            <section>
                <h3>Why databases?</h3>

                <p>Web apps use databases to store data that needs to be shared across multiple users or computers. </p>
                
                <img src="app_with_sql.png" alt="Diagram using SQL to update and query a database storing data for a web application"/>
            </section>


            <section>
                <h3>Database types</h3>

                <figure style="float:right;" style="width:30%;">
                    <img src="graph_databases.png" alt="Graph of  database popularity">
                    <figcaption style="font-size:0.5em;">Source: <a target="_blank" href="https://www.jetbrains.com/lp/devecosystem-2023/databases/">JetBrains Developers Survey 2023</a></figcaption>
                </figure>

                <div style="float:left; width: 60%;">
                <p>Two main types of databases:</p>
                <ul>
                    <li><strong>Non-relational databases</strong>, such as...
                        <ul>
                            <li>MongoDB
                            <li>Redis
                            <li>Cosmos DB for NoSQL
                        </ul>
                    </li>
                    <li><strong>Relational databases</strong>, such as... 
                        <ul>
                            <li>PostgreSQL
                            <li>MySQL
                            <li>SQLite
                            <li>MS SQL server
                    </li>
                </ul>
                </div>
            </section>

            <section>
                <h3>Non-relational databases</h3>

                <p>A <strong>non-relational database</strong> stores data in a very flexible way,
                often as JSON documents or as key-value stores.</p>

                <p>Example document in a <strong>MongoDB</strong> collection:</p>
                <pre><code data-trim data-noescape class="json">
                {
                    "username": "Pamela Fox",
                    "email": "pamelafox@microsoft.com"
                }
                </code></pre>

                <p class="padded">Example key-value pair in a <strong>Redis</strong> store:</p>
                <pre><code data-trim data-noescape class="shell">
                usersession1234: { "username": "Pamela Fox", "email": "pamelafox@microsoft.com" }
                </code></pre>
            </section>
            
            <section>
                <h3>Relational databases</h3>

                <p>A <strong>relational database</strong> contains <strong>tables</strong>. <br>
                    Each table has <strong>columns</strong> and <strong>rows</strong>.</p>
                
                <p>Example table called <code>speakers</code>:</p>
                <table>
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>name</th>
                            <th>title</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Pamela Fox</td>
                            <td>Python Cloud Advocate</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Renee Noble</td>
                            <td>Python Cloud Advocate</td> 
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Victor Vazquez</td>
                            <td>Software Developer</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Dawn Wages</td>
                            <td>Python Community Advocate</td>
                        </tr>
                </table>
            </section>

            <section>
                <h3>SQL</h3>

                <p><strong>SQL (Structured Query Language)</strong> is a language for querying and modifying relational databases.</p>

                <p>SQL commands:</p>
                <ul>
                    <li><code>SELECT</code> - get data
                    <li><code>INSERT</code> - add data
                    <li><code>UPDATE</code> - modify data
                    <li><code>DELETE</code> - remove data
                </ul>

                <p>Learn SQL for free with my course on Khan Academy:
                    <a target="_blank" href="https://www.khanacademy.org/computing/computer-programming/sql">khanacademy.org/computing/computer-programming/sql</a>
                </p>

                <aside class="notes">
                    Show book challenge
                </aside>
            </section>

            <section>
                <h3>PostgreSQL</h3>

                <p><a target="_blank" href="https://www.postgresql.org/">PostgreSQL</a> is a popular open-source relational database that supports JSON, XML, and other data types.</p>

                <pre><code data-trim data-noescape class="sql">
                CREATE TABLE cities (
                    name            varchar(80),
                    location        point
                );
                INSERT INTO cities VALUES ('San Francisco', '(-194.0, 53.0)');
                SELECT name FROM cities WHERE location <@ circle '((0,0), 300)';
                </code></pre>

                <p>There are many popular extensions for PostgreSQL like
                    <a target="_blank" href="https://postgis.net/">PostGIS</a> for geospatial data and
                    <a target="_blank" href="https://github.com/pgvector/pgvector">pgvector</a> for vector similarity search.</p>

                <p>Python libraries for PostgreSQL:
                    <a target="_blank" href="https://www.psycopg.org/">psycopg (driver)</a>,
                    <a target="_blank" href="https://www.sqlalchemy.org/">SQLAlchemy (ORM)</a>
                </p>
                <p>Playgrounds: <a target="_blank" href="https://github.com/pamelafox/postgresql-playground">PostgreSQL playground</a>,
                    <a target="_blank" href="https://github.com/pamelafox/pgvector-playground">pgvector playground</a></p>
            </section>

            <section>
                <h3>Exercise: Play with PostgreSQL</h3>

                <p>Using this repo:<br>
                    <a  target="_blank" class="smaller" href=https://github.com/pamelafox/postgresql-playground">github.com/pamelafox/postgresql-playground</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/postgres-playground">aka.ms/postgres-playground</a>
                </p>

                <ol>
                    <li>Open in GitHub Codespaces or VS Code with Dev Containers extension
                    <li>Copy <code>.env.devcontainer</code> into a <code>.env</code> file
                    <li>Open the SQLTools extension from the sidebar and select 'Local database'
                    <li>Enter these SQL statements and select 'Run on active connection':

                    <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="sql">
                        CREATE TABLE restaurants (id SERIAL PRIMARY KEY, name VARCHAR(255) NOT NULL);
                        INSERT INTO restaurants (name) VALUES ('Casa Latina');
                        SELECT * FROM restaurants;
                    </code></pre>

                    <li>Explore the results in the extension
                </ol>
            
            </section>
                        

            <section class="heading-only">
                <h2>Accessing databases from Python</h2>

                <img src="../static/images/BIT_PYTHON.svg" alt="Bit (the raccoon) coding" width="400">
            </section>
            
            <section>
                <h3>Accessing databases from Python: SQL</h3>

                <p>One option is to call SQL directly from a database driver.</p>

                <pre style="height:480px;"><code data-trim data-noescape class="python">
                import psycopg2

                conn = psycopg2.connect(
                    host=os.environ["PGHOST"],
                    database=os.environ["PGDATABASE"],
                    user=os.environ["PGUSSER"],
                    password=os.environ["PGPASS"],
                )
                cur = conn.cursor()
                cur.execute("CREATE TABLE restaurants (id SERIAL PRIMARY KEY, name VARCHAR(255) NOT NULL)")
                conn.commit()
                cur.close()
                </code></pre>
            </section>

            <section>
                <h3>Risks of using SQL directly</h3>

                <p>‚ö†Ô∏è Executing raw SQL makes your app vulnerable to SQL injection attacks.
                </p>

                <p>What you expect:</p>
                <pre style="font-size: 0.8em;" class="no-code-badge"><code data-trim data-noescape class="python ">
                user_input = "Bobby"
                query = "SELECT name, id FROM users where name = " + user_input
                </code></pre>

                <div class="fragment">
                <p>What a hacker could do:</p>
                <pre style="font-size: 0.8em;" class="no-code-badge"><code data-trim data-noescape class="python">
                user_input = "Bobby); DROP TABLE students;"
                query = "SELECT name, title id users where name = " + user_input
                </code></pre>

                <a target="_blank" href="https://xkcd.com/327/">
                From: xkcd.com/327</a>
                </p>
                
                </div>
            </section>

            <section>
                <h3>Accessing databases from Python: ORM</h3>

                <p>A safer approach is to use an <strong>ORM (Object-Relational Mapper)</strong> to interact with the database.</p>

                <p>An ORM represents table rows as Python objects, and provides methods for querying and modifying data.</p>

                <p>A <a target="_blank" href="https://www.sqlalchemy.org/">SQLAlchemy</a> example:</p>
                <pre><code data-trim data-noescape class="python">
                class Restaurant(Base):
                    __tablename__ = "restaurants"
                    id: Mapped[int] = mapped_column(primary_key=True)
                    name: Mapped[str]
                    rating: Mapped[int]
                
                query = select(Restaurant).where(Restaurant.title == "Casa Latina")
                results = session.execute(query)
                </code></pre>
            
            </section>

            <section>
                <h3>Querying with SQLAlchemy 2.0</h3>

                <p class="padded">Get by primary key:</p>
                <pre style="margin-top:-10px;"><code data-trim data-noescape class="python">
                session.get(Restaurant, 42)
                </code></pre>

                <p class="padded">Get all rows in table:</p>
                <pre style="margin-top:-10px;"><code data-trim data-noescape class="python">
                session.execute(select(Restaurant)).scalars().all()
                </code></pre>
                
                <p class="padded">Finding rows by column value:</p>
                <pre style="margin-top:-10px;"><code data-trim data-noescape class="python">
                session.execute(select(Restaurant).where(
                    Restaurant.name == "Casa Latina")).scalars().all()
                </code></pre>

                <p class="padded">Play with queries in 
                <a target="_blank" href="https://github.com/pamelafox/postgresql-playground">PostgreSQL Playground</a>
                <br>
                <a target="_blank" class="smaller aka" href="https://aka.ms/postgres-playground">aka.ms/postgres-playground</a>
                </p>
            </section>

            <section class="heading-only">
                <h2>Flask + databases</h2>

                <img src="../static/images/BIT_DEV.svg" alt="Bit (the raccoon) with a laptop" width="400">
            </section>

            <section>
                <h3>Using Flask with SQLAlchemy</h3>

                <p><a target="_blank" href="https://flask.palletsprojects.com/">Flask</a> is a lightweight web framework for Python,
                    which does <strong>not</strong> come with any built-in database functionality.
                </p>

                <p>A common way to use Flask with SQLAlchemy:</p>

                <ul>
                    <li>Install <a target="_blank" href="https://github.com/pallets-eco/flask-sqlalchemy">Flask-SQLAlchemy</a> extension
                    <li>Install <a target="_blank" href="https://flask-migrate.readthedocs.io/en/latest/index.html">Flask-Migrate</a> extension
                    <li>Define models using Python classes
                    <li>Run database migrations
                    <li>Use SQLAlchemy queries in routes
                </ul>
            </section>

            <section>
                <h3>Example: Flask + PostgreSQL</h3>

                <p class="smaller"><a  target="_blank" href="https://github.com/Azure-Samples/azure-flask-postgres-flexible-appservice">github.com/Azure-Samples/azure-flask-postgres-flexible-appservice</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/flask-pg-app">aka.ms/flask-pg-app</a>
                </p>

                <UL>
                    <li>App setup is in <a target="_blank" href="https://github.com/Azure-Samples/azure-flask-postgres-flexible-appservice/blob/main/src/flaskapp/__init__.py">__init__.py</a>.
                    <li>Routes are in <a target="_blank" href="https://github.com/Azure-Samples/azure-flask-postgres-flexible-appservice/blob/main/src/flaskapp/pages.py">pages.py</a>.
                    <li>Models are in <a target="_blank" href="https://github.com/Azure-Samples/azure-flask-postgres-flexible-appservice/blob/main/src/flaskapp/models.py">models.py</a> and use <a target="_blank" href="https://www.sqlalchemy.org/">SQLAlchemy 2.0</a>.
                </ul>

                <p class="padded">Run app server:</p>
                <pre style="font-size:0.7em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                python3 -m flask --app src.flaskapp run --debug --reload --port=8000
                </code></pre>

            </section>

            <section>
                <h3>Database migrations</h3>

                <p>Migrations are a way to keep track of changes to the database schema.</p>

                <ol>
                    <li>When you make a change to the database schema, create a migration file.</p>

                <p class="smaller">Using Flask-Migrate:</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                python3 -m flask --app src.flaskapp db migrate --directory src/flaskapp/migrations
                </code></pre>

                <li>Run the migration file to update the database.</p>

                <p class="smaller">Using Flask-Migrate:</p>
                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                python3 -m flask --app src.flaskapp db upgrade --directory src/flaskapp/migrations
                </code></pre>
                </ol>
            </section>
            <section>
                <h3>Exercise: Flask app</h3>

                <p>Using this repo:<br>
                    <a  target="_blank" href="https://github.com/Azure-Samples/azure-flask-postgres-flexible-appservice">github.com/Azure-Samples/azure-flask-postgres-flexible-appservice</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/flask-pg-app">aka.ms/flask-pg-app</a>
                <ol>
                    <li>Follow the readme steps to get the app running.
                    <li>Inspect the local DB tables using SQLTools extension.
                    <li>Submit an info request and find new row in SQLTools.
                    <li>Change the destinations route to return destinations
                        ordered by name, using
                        <a target="_blank" href="https://docs.sqlalchemy.org/en/20/tutorial/data_select.html#order-by">order_by</a>.
                    <li>Reload and confirm the destinations appear sorted.
                </ol>
            </section>

            <section>
                <h3>More Flask + DB examples</h3>


                <ul>
                    <li><a  target="_blank" href="https://github.com/pamelafox/flask-db-quiz-example/">github.com/pamelafox/flask-db-quiz-example</a>
                    <li><a target="_blank" href="https://github.com/pamelafox/translation-telephone">github.com/pamelafox/translation-telephone</a>
                    <li><a target="_blank" href="https://github.com/pamelafox/flask-surveys-container-app">github.com/pamelafox/flask-surveys-container-app</a>
                </ul>

                <p>Also check out the <a target="_blank" href="https://flask.palletsprojects.com/en/3.0.x/tutorial/">Flask tutorial</a>.</p>
            </section>

            <section class="heading-only">
                <h2>Generative AI + Databases</h2>

                <img src="../static/images/BIT_AI.svg" alt="Bit (the raccoon) with a robot" width="400">
            </section>

            <section>
                <h3>Vector search</h3>

                <p>Vector search is a way to find similar items in a database,
                    and is used in recommendation systems, search engines, and chatbots.</p>

                <p>SQL:</p>
                <pre><code data-trim data-noescape class="sql">
                SELECT * FROM items ORDER BY embedding &lt;=> '[3,1,2]' LIMIT 5;
                </code></pre>
                <p class="padded">SQLAlchemy:</p>
                <pre><code data-trim data-noescape class="python">
                  closest = session.scalars(
                    select(Item).order_by(Item.embedding.cosine_distance(target_embedding)).limit(5)
                  )
                  for item in closest:
                      print(item.title)
                </code></pre>
  
                <p>Try it in: <a target="_blank" href="https://github.com/pamelafox/pgvector-playground">github.com/pamelafox/pgvector-playground</a></p>
            </section>

              
            <section>
                <h3>RAG: Retrieval Augmented Generation</h3>

                <img src="rag_postgres.png" alt="Diagram of RAG: Retrieval Augmented Generation" style="height:400px;">
            </section>

            <section>
                <h3>RAG with PostgreSQL</h3>

                <p>We can use LLMs to answer questions about PostgreSQL tables.</p>

                <p>Example: <a target="_blank" href="https://github.com/Azure-Samples/rag-postgres-openai-python/">
                    Azure-Samples/rag-postgres-openai-python</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/rag-postgres">aka.ms/rag-postgres</a>
                </p>
                
                <img src="screenshot_ragpostgres.png" alt="Screenshot of a chatbot answering questions about a PostgreSQL database" style="height:300px;">

                <p class="smaller">That example uses FastAPI, but it could also use Flask/Quart.</p>

                <aside class="notes">
                    https://ragpostgres-ndj764e-ca.whiteglacier-476a7757.eastus2.azurecontainerapps.io/
                </aside>
            </section>

            <section>
                <h3>More resources: GenAI + PostgreSQL</h3>

                <p>Recorded talks:</p>
                <img src="https://i.ytimg.com/vi/3ctFWU492xk/hqdefault.jpg?sqp=-oaymwEcCNACELwBSFXyq4qpAw4IARUAAIhCGAFwAcABBg==&rs=AOn4CLAWFJ8iU3TjvCXeymMnQ83DxEILJg" style="float:right; height:100px; margin-left: 10px;">
                <ul style="float:left; width: 70%;">
                    <li>
                        <a target="_blank" href="https://speakerdeck.com/pamelafox/building-a-rag-powered-ai-chat-app-with-python-and-vs-code">

                            Building a RAG-powered AI chat app with Python</a><br>by Pamela Fox
                        </ul>


                <p style="clear:both;">Upcoming Posette talks:</p>

                <img src="posette.png" alt="Posette conference banner" style="float:right; width: 25%; border: 1px solid #ccc;">
                <ul style="float:left; width: 70%;">
                    <li>
                    <a target="_blank" href="https://www.citusdata.com/posette/speakers/pamela-fox/">
                    pgvector for Python developers
                    </a><br>by Pamela Fox
                    <li>
                    <a target="_blank" href="https://www.citusdata.com/posette/speakers/paolo-melchiorre">
                        Semantic search with Django, PostgreSQL, & pgvector
                    </a><br>by Paolo Melchiorre
                </ul>

            </section>

            <section class="heading-only">
                <h2>Hosting web apps + databases</h2>
                <img src="../static/images/BIT_AZURE.png" alt="Bit (the raccoon) on a cloud with the Azure logo" width="400">
            </section>


            <section>
                <h3>Database hosting options</h3>

                <p>Consider:</p>
                <ul>
                    <li>How much database storage do you need?
                    <li>How many database read/writes do you expect?
                    <li>How much latency can you tolerate between app/DB?
                    <li>What sort of backup policy do you need?
                    <li>Data sovereignty: where can your data be stored?
                    <li>Do you need multiple replicas for high availability?
                </ul>
            </section>


            <section>
                <h3>Managed services for PostgreSQL on Azure</h3>

                <style>
                .fragment.background-green {
                    background-color: transparent;
                }
                .fragment.background-green.visible {
                    background-color: aquamarine;
                }
                </style>

                <table>
                    <thead>
                        <tr>
                            <th>Option</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Azure Database for PostgreSQL ‚Äì Single Server</td>
                            <td>Microsoft's original offering. No longer recommended for new apps.</td>
                        </tr>
                        <tr class="fragment custom background-green">
                            <td>Azure Database for PostgreSQL ‚Äì Flexible Server</td>
                            <td>Microsoft's most recent PostgreSQL offering. Fully managed service with vertical scaling.
                            </td>
                        </tr>
                        <tr>
                          <td>Azure Cosmos DB for PostgreSQL</td>
                          <td>Distributed database using PostgreSQL and the Citus extension. Can scale horizontally.
                          </td>
                        <tr>
                            <td>Azure Container Apps PostgresQL service
                            <td>A sidecar service that runs alongside your containerized app.
                      </tr>
                    </tbody>
                </table>

                <p class="smaller">
                   <a target="_blank" href="https://devblogs.microsoft.com/cosmosdb/azure-cosmos-db-for-postgresql-vs-azure-database-for-postgresql-when-to-choose-which/">
                    
                    Cosmos DB for PostgreSQL vs. Flex Server  
                    <span class="aka" style="margin-top: 16px; margin-left: 8px;"> üîó aka.ms/flex-vs-cosmos</span>
                </a>
                </p>
            </section>

            <section>
                <h3>Exercise: Deploy a PostgreSQL Flexible Server</h3>

                <p>Using this repo:<br>
                    <a  target="_blank" class="smaller" href="https://github.com/Azure-Samples/azure-postgres-pgvector-python">github.com/Azure-Samples/azure-postgres-pgvector-python</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/azure-postgres-pgvector">aka.ms/azure-postgres-pgvector</a>
                </p>

                <ol>
                    <li>Open in GitHub Codespaces or VS Code with Dev Containers extension
                    <li>Sign up for a <a target="_blank" href="https://azure.microsoft.com/free/">free Azure account</a>
                    <li>Follow the Deploying instructions in the README
                    <li>Run a script to confirm the database is working
                </ol>
            </section>

            <section>
                <h3>Web app hosting options</h3>

                <p>The web app can be hosted on the same server as the database, or on a separate server.
                </p>

                <p>Many possible hosts:
                <ul>
                    <li>A rented computer in a data center
                    <li>A virtual machine
                    <li>A PaaS (platform as a service)
                </ul>

                <p>Consider:
                <ul>
                    <li>How much control do you want?
                    <li>How much do you enjoy administering systems?
                    <li>Do you need your app to scale up/out?
                </ul>
            </section>

            <section>
                <h3>Azure web app hosting options</h3>
                
                <style>
                table.deploy-stack {
                    border-spacing: 30px; 
                    border-collapse: separate;
                    border: 0px;
                }

                table.deploy-stack th, table.deploy-stack td {
                    font-size: 20px;
                    border-bottom: 0px none;
                    border-radius: 12px;
                    text-align: center;
                    vertical-align: middle;
                    padding: 8px;
                }
                </style>
                <table class="deploy-stack">
                    <tr>
                        <th>
                        <td>
                        <td style="background-color: #00bc70; color: white;">Azure Container Apps
                        <td>
                        <td style="background-color: #00bc70; color: white;">Azure Functions
                    </tr> 
                    <tr>
                        <th>
                        <td style="background-color: #00bc70; color: white;">Azure Kubernetes Service
                        <td style="background-color: #0070c0; color: white;">Container Management
                        <td style="background-color: #00bc70; color: white;">Azure App Service
                        <td style="background-color: #0070c0; color: white;">Serverless
                        
                    </tr>
                    <tr>
                        <th>Environment
                        <td colspan="2" style="background-color:#0070c0; color: white;">Containers
                        <td colspan="2" style="background-color:#0070c0; color: white;">PaaS
                    </tr>
                    <tr>
                        <th>Cloud
                        <td colspan="4" style="background-color:#ccc;">Azure
                    </tr>
                </table>
                <p class="fragment smaller">For Flask, <span style="background-color: #00bc70; color: white; padding-left: 8px; padding-right: 8px; border-radius: 8px;">App Service</span> is an easy way to get started.</p>
            </section>


            <section>
                <h3>But wait, there's more!</h3>

                <p>Your app may need more than just a web server and a database.</p>

                <table>
                    <tr>
                        <th>Networking
                        <td>DNS Zone, Virtual Network, VPN Gateway, ...
                    <tr>
                        <th>Security
                        <td>Key Vault, Security Center, ...
                    <tr>
                        <th>Storage
                        <td>Blob Storage, Files, Archive Storage, ...
                    <tr>
                        <th>Caching
                        <td>CDN, Front Door, ...
                    <tr>
                        <th>Machine Learning
                        <td>Translator, Bot Service, Computer Vision, ...
                    <tr>
                        <th colspan="2">...and more!
                </table>

            </section>

            <section>
                <h3>Hosting Python + PostgreSQL on Azure</h3>

                <p>
                <img src="flaskdb.drawio.png" alt="Flask app architecture diagram: App Service, App Service Plan, PostGreSQL server, Log Analytics workspace">
                </p>

                <p>Using the <a target="_blank" href=https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/overview?WT.mc_id=python-79461-pamelafox">Azure Dev CLI</a>:</p>
                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                azd up
                </code></pre>
            </section>

            <section>
                <h3>Exercise: Deploying an app</h3>

                <ol>
                    <li>Sign up for a <a target="_blank" href="https://azure.microsoft.com/free/?WT.mc_id=python-81211-pamelafox">free Azure account</a>
                    <li>Either open one of the previous projects in Codespaces 
                        or follow <a target="_blank" href="https://learn.microsoft.com/azure/developer/azure-developer-cli/install-azd?WT.mc_id=python-81211-pamelafox">these installation steps for the Azure Developer CLI.</a>
                    <li>Run <code>azd up</code>. If prompted, login to your Azure account.
                    <li>If it deploys successfully, visit the endpoint URL to confirm it's working.
                    <li>Run <code> azd down</code> to un-deploy the app (so that you don't waste cloud resources unnecessarily).
                </ol>
            </section>

            <section>
                <h3>Security considerations</h3>

                <p>When connecting to a database from a web app, consider...</p>

                <p>Restricting authentication:</p>
                <ul class="smaller">
                    <li>‚≠êÔ∏è Use passwordless authentication for the database
                        <br>
                        See <a target="_blank" class="smaller aka" href="https://aka.ms/azure-postgres-pgvector">aka.ms/azure-postgres-pgvector</a>
                        and <a target="_blank" class="smaller aka" href="https://aka.ms/rag-postgres">aka.ms/rag-postgres</a>
                    <li>If you do have to use passwords, store in Azure KeyVault<br>
                        See <a target="_blank" class="smaller aka" href="https://aka.ms/flask-pg-app">aka.ms/flask-pg-app</a>
                </ul>
                <div class="fragment">
                <p>Restricting network access:</p>
                <ul class="smaller">
                    <li>‚≠êÔ∏è Put the database and app in the same virtual network<br>
                        See <a target="_blank" class="smaller aka" href="https://github.com/Azure-Samples/msdocs-flask-postgresql-sample-app">aka.ms/flask-pg-vnet</a>
                    <li>If you can't use a VNet, use a firewall to restrict access to the database<br>
                        See <a target="_blank" class="smaller aka" href="https://aka.ms/flask-pg-app">aka.ms/flask-pg-app</a>
                        <br>
                        ‚ö†Ô∏è The firewall still allows access from other Azure-hosted apps.
                </ul>
                </div>
            </section>

            <section>
                <h3>More Azure resources</h3>

                <img src="../static/images/BIT_COWORKING.png" alt="Raccoons with laptops" width="35%" style="float:right;">

                <ul style="float:left; width: 60%; display: grid; gap: 18px;">
                    <li><a target="_blank" href="https://learn.microsoft.com/en-us/azure/app-service/quickstart-python?WT.mc_id=python-81211-pamelafox">Deploy a Python (Django or Flask) web app to Azure App Service</a>
                    <li><a target="_blank" href="https://learn.microsoft.com/en-us/azure/app-service/tutorial-python-postgresql-app?WT.mc_id=python-81211-pamelafox">Deploy a Python (Django or Flask) web app with PostgreSQL in Azure</a>
                    <li><a target="_blank" href="https://learn.microsoft.com/en-us/azure/developer/python/quickstarts-app-hosting?WT.mc_id=python-81211-pamelafox">Hosting Python apps on Azure</a>
                    <li><a target="_blank" href="https://code.visualstudio.com/docs/python/python-tutorial">Getting Started with Python in VS Code</a>
                    <li><a target="_blank" href="https://aka.ms/python-discord">MS Python Discord: aka.ms/python-discord</a>
                </ul>
            </section>

            <section class="heading-only">
                <h2>Any questions?</h2>
                <img src="../static/images/BIT_STUDENTS.svg" alt="A bunch of raccoon students with computers" width="400">
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.1.0/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.1.0/plugin/highlight/highlight.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-badge@0.1.9/highlightjs-badge.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.js"></script>
    <script>
        Reveal.initialize({
            width: 1280,
            height: 720,
            hash: true,
            center: false,
            slideNumber: true,
            showNotes: false,
            margin: 0.1,
            preloadIframes: true,
            autoPlayMedia: true,
            plugins: [ RevealHighlight, RevealMenu ],
            pdfSeparateFragments: true
        });
        window.highlightJsBadge();

    </script>
    </body>
</html>