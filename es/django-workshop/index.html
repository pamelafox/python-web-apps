
<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Aplicaciones web de Python: Django</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reset.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/simple.css" id="theme">
        <link rel="stylesheet" href="https://pamelafox.github.io/python-web-apps/static/a11y-dark.min.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:300,400,500|Work+Sans:400,700">
        <link rel="stylesheet" href="https://pamelafox.github.io/python-web-apps/static/slides.css">
        <link rel="icon" href="https://pamelafox.github.io/python-web-apps/static/images/BIT_ICON.png">
	</head>
    <body>
    <div class="reveal">
        <div class="slides">

            <section class="heading-only" style="padding-top:5%">
                <h1 style="font-size:120px">Aplicaciones web en Python:<br>
                    Django</h1>
            </section>

            <section>
                <h3>Conoce a V√≠ctor V√°zquez</h3>

                <img src="https://avatars.githubusercontent.com/u/24213737"
                    alt="Foto de V√≠ctor junto a Jessica, su esposa, en Queretaro Mx" style="float:right; height:400px;">
                <p>Desarrollador en Microsoft (<a target="_blank" href="https://aka.ms/azd">azd</a>)</p>
                <br>
                <p>Redes sociales:</p>
                <table style="width:40%; float: left; font-size:28px;">
                    <tr>
                        <td>Twitter
                        <td><a target="_blank" href="https://twitter.com/vhvb1989">@vhvb1989</a></td>
                    </tr>
                    <tr>
                        <td>GitHub
                        <td><a target="_blank" href="https://www.github.com/vhvb1989">/vhvb1989</a></td>
                    </tr>
                    <tr>
                        <td>LinkedIn
                        <td><a target="_blank" href="https://www.linkedin.com/in/vhvb1989/">in/vhvb1989</a></td>
                    </tr>
                </table>
            </section>

            <section>
                <h3>Temas de hoy</h3>

                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_PUBLIC_SPEAKING.svg" alt="Bit (el mapache) dando una conferencia" width="300" style="float:right;">
                <ul style="margin-top:20px; font-size:44px; line-height: 1.5em; float:left; width:750px;">
                    <li>Django 101
                        <ul class="smaller">
                            <li>üë©üèæ‚Äçüíª Ejercicio #1: Aplicaci√≥n Django
                        </ul>
                    <li>Depuraci√≥n de Django
                    <li>M√°s sobre Django
                    <li>Django en Producci√≥n
                    <li>Alojamiento de Django
                        <ul class="smaller">
                            <li>üë©üèª‚Äçüíª Ejercicio #2: Implementaci√≥n de Django
                        </ul>
                </ul>
            </section>

            <section>
                <h3>Configuraci√≥n para ejercicios</h3>

                        <p>Para seguir los ejercicios, tienes las siguientes opciones:</p>
                        <ol>
                            <li>                                
                                <div style="display: grid; grid-template-columns: 1.5fr 1fr; grid-template-rows: 1fr;">
                                    <div>
                                        Desarrollo en l√≠nea con Codespaces: 
                                        <ul>
                                            <li><a target="_blank" href="https://github.com/signup">Cuenta de GitHub</a>
                                        </ul>
                                    </div>                                
                                    <div style="background-color: #f0f0f0; padding: 10px;">
                                        Repositorios que utilizaremos:
                                        <ul>
                                            <li><a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-appservice">aka.ms/django-pgflex-app</a></li>
                                            <li><a target="_blank" href="https://github.com/pamelafox/django-quiz-app">aka.ms/django-quiz-app</a></li>
                                        </ul>
                                    </div>
                                </div>
                            <li class="padded">Desarrollo local con VS Code:
                            <ul>
                                <li><a target="_blank" href="https://code.visualstudio.com/Download">Visual Studio Code</a></li>
                                <li><a target="_blank" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Extensi√≥n Dev Containers</a></li>
                                <li><a target="_blank" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a></li>
                            </ul>
        
                            <li class="padded">Desarrollo local con cualquier editor:
                            <ul>
                                <li><a target="_blank" href="https://www.python.org/downloads/">Python 3</a></li>
                                <li><a target="_blank" href="https://www.postgresql.org/download/">PostgreSQL</a></li>
                            </ul>
                        </ol>

            </section>

            <section>
                <h3>Framework Django</h3>

                <img src="coursera_django.png" alt="Captura de pantalla del administrador de Coursera" width="600" style="float:right; margin-left:10px">
                <p><a target="_blank" href="https://www.djangoproject.com/">Django</a>, una biblioteca externa, es un framework con opiniones para el c√≥digo del lado del servidor. Incluye un ORM para la interacci√≥n con la base de datos.</p>
                
                <p>Algunas aplicaciones escritas en Django:</p>
                <ul>
                    <li>Instagram
                    <li>Eventbrite
                    <li>Coursera (originalmente, ahora Scala+Play)
                    <li>Pinterest (originalmente, ahora Flask)
                </ul>
            </section>

            <section>
                <h3>Ejemplo: Django + PostgreSQL</h3>

                <p>
                    <a  target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-appservice">github.com/Azure-Samples/azure-django-postgres-flexible-appservice</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/django-pgflex-app">aka.ms/django-pgflex-app</a>
                </p>

                <p class="padded">Ejecutar migraciones de la base de datos:</p>
                <pre style="font-size:0.9em; margin-top: -5px;"><code data-trim data-noescape class="shell">
                python3 src/manage.py migrate
                </code></pre>

                <p class="padded">Cargar datos de prueba:</p>
                <pre style="font-size:0.9em; margin-top: -5px;"><code data-trim data-noescape class="shell">
                python3 src/manage.py loaddata src/seed_data.json
                </code></pre>

                <p class="padded">Ejecutar el servidor:</p>
                <pre style="font-size:0.9em; margin-top: -5px;"><code data-trim data-noescape class="shell">
                python3 src/manage.py runserver 8000
                </code></pre>

            </section>

            <section>
                <h3>Estructura del proyecto Django</h3>

                <p>Esta aplicaci√≥n sigue una estructura de proyecto Django t√≠pica:</p>

                <pre style="font-size:0.6em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                src/
                    manage.py
                    project/
                        __init__.py
                        asgi.py
                        settings.py
                        urls.py
                        wsgi.py
                    relecloud/
                        __init__.py
                        admin.py
                        apps.py
                        models.py
                        urls.py
                        views.py
                    templates/
                </code></pre>

                <p>La carpeta <code>relecloud</code> representa una "app" de Django. 
                    Podemos agregar m√°s "app"s al proyecto, cada una con sus propios modelos, vistas, urls, etc.</p>
            </section>

            <section>
                <h3>Modelos de Django</h3>

                <p>Los modelos son clases de Python que representan tablas de la base de datos.</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="python">
                from django.db import models

                class Destination(models.Model):
                    name = models.CharField(unique=True, max_length=50, null=False, blank=False)
                    subtitle = models.CharField(unique=False, max_length=240, null=False, blank=True)
                    description = models.TextField(max_length=2000, null=False, blank=False)
                </code></pre>

                <p>üîó Desde <a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca/blob/main/src/relecloud/models.py">models.py</a></p>

                <p>Para crear una migraci√≥n:</p>
                <pre style="font-size:0.8em; margin-top: -10px;"><code data-trim data-noescape class="shell">
                python3 src/manage.py makemigrations
                </code></pre>

                <p>Para aplicar la migraci√≥n:</p>
                <pre style="font-size:0.8em; margin-top: -10px;"><code data-trim data-noescape class="shell">
                python3 src/manage.py migrate
                </code></pre>

                <aside class="notes">
                    agregar temperatura, migrar, instalar sqltools, actualizar
                </aside>
            </section>

            <section>
                <h3>Vistas de Django</h3>

                <p>Las vistas pueden ser funciones simples de Python:</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="python">
                def index(request):
                    return render(request, "index.html")
                </code></pre>

                <p>O subclases de las <a target="_blank" href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/generic-display/">vistas gen√©ricas</a> de Django:</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="python">
                class CruiseDetailView(generic.DetailView):
                    template_name = "cruise_detail.html"
                    model = models.Cruise
                </code></pre>

                <p>üîó Desde <a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca/blob/main/src/relecloud/views.py">views.py</a>
                </p>

            </section>

            <section>
                <h3>Plantillas de Django</h3>

                <p>Las plantillas son archivos HTML escritos en <a target="_blank" href="https://docs.djangoproject.com/5.0/ref/templates/language/">lenguaje de plantillas de Django</a> (similar a Jinja2):</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="html">
                &lt;p&gt;Este crucero visita los siguientes destinos:&lt;/p&gt;
                {% for destination in cruise.destinations.all %}
                &lt;a class="list-group-item list-group-item-action" href="{% url 'destination_detail' destination.id %}"&gt;{{ destination }}&lt;/a&gt;
                {% endfor %}
                </code></pre>

                <p>üîó Desde <a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca/tree/main/src/templates">templates/destination_detail.html</a>
                </p>
            </section>

            <section>
                <h3>URLs de Django</h3>

                <p>Las URLs mapean rutas a vistas:</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="python">
                urlpatterns = [
                    path("", views.index, name="index"),
                    path("about", views.about, name="about"),
                    path("destinations/", views.destinations, name="destinations"),
                    path(
                        "destination/&lt;int:pk&gt;",
                        views.DestinationDetailView.as_view(),
                        name="destination_detail",
                    ),
                    path("cruise/&lt;int:pk&gt;", views.CruiseDetailView.as_view(), name="cruise_detail"),
                    path("info_request", views.InfoRequestCreate.as_view(), name="info_request"),
                ]
                </code></pre>

                <p>üîó Desde <a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca/blob/main/src/relecloud/urls.py">urls.py</a>
                </p>

            </section>

            <section>
                <h3>Administrador de Django</h3>

                <p>Django incluye una interfaz de administrador incorporada para gestionar datos.</p>

                <pre><code data-trim data-noescape class="python">
                admin.site.register(models.Cruise)
                admin.site.register(models.Destination)
                admin.site.register(models.InfoRequest)
                </code></pre>

                <p>üîó Desde <a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca/blob/main/src/relecloud/admin.py">admin.py</a></p>

                <p class="padded">Para iniciar sesi√≥n en la interfaz de administrador:</p>
                <ul>
                    <li>Crea un superusuario:

                    <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                    python3 src/manage.py createsuperuser
                    </code></pre>

                    <li>Reinicia el servidor y navega a "/admin"
                    <li>Inicia sesi√≥n con las credenciales del superusuario.
                </ul>
            </section>

            <section>
                <h3>Ejercicio: Aplicaci√≥n Django</h3>

                <p>Usando este repositorio:<br>
                    <p class="smaller"><a  target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-appservice">github.com/Azure-Samples/azure-django-postgres-flexible-appservice</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/django-pgflex-app">aka.ms/django-pgflex-app</a>
                </p>
                
                <ol>
                    <li>Sigue los pasos del archivo README para ejecutar la aplicaci√≥n.
                    <li>Inspecciona las tablas de la base de datos local utilizando la extensi√≥n SQLTools.
                    <li>Sigue los pasos del archivo README para acceder al administrador de Django.
                    <li>Agrega un nuevo destino utilizando el administrador de Django.
                    <li>Cambia la ruta de los destinos para ordenarlos por nombre, utilizando <a target="_blank" href="https://docs.djangoproject.com/en/4.2/ref/models/querysets/#order-by">order_by</a>.
                </ol>
            </section>

            <section class="heading-only">
                <h2>Depuraci√≥n en VS Code</h2>

                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_DEV.svg" alt="Bit (el mapache) con una computadora y el logotipo de VS Code" width="400">
            </section>

            <section>
                <h3>Depuraci√≥n de c√≥digo Python</h3>

                <p style="margin-bottom:0px">.vscode/launch.json:</p>
                <pre style="font-size:0.55em; margin-top:6px;"><code data-trim data-noescape class="json">
                {
                  "version": "0.2.0",
                  "configurations": [{
                        "name": "Python: Django",
                        "type": "debugpy",
                        "request": "launch",
                        "program": "${workspaceFolder}/src/manage.py",
                        "args": [
                            "runserver"
                        ],
                        "django": true,
                        "justMyCode": true
                    }]}
                </code></pre>

                <p class="padded" style="margin-bottom:0px">En settings.py:</p>
                <pre style="font-size:0.55em; margin-top:6px;"><code data-trim data-noescape class="json">
                DEBUG_PROPAGATE_EXCEPTIONS = env("DEBUG") # True localmente
                </code></pre>

            </section>

            <section>
                <h3>Depuraci√≥n de plantillas</h3>

                <p style="margin-bottom:0px">Agrega al archivo .vscode/launch.json:</p>
                <pre style="font-size:0.55em; margin-top:6px;"><code data-trim data-noescape class="json">
                {
                    "version": "0.2.0",
                    "configurations": [{
                        "name": "Python: Django",
                        "type": "debugpy",
                        "request": "launch",
                        "program": "${workspaceFolder}/src/manage.py",
                        "args": [
                            "runserver"
                        ],
                        "django": true,
                        "justMyCode": true,
                        "jinja": true // Agrega esta l√≠nea
                }]}
                </code></pre>
            </section>


            <section class="heading-only">
                <h2>M√°s sobre Django</h2>

                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_STUDENTS.svg" alt="Bit (el mapache) con amigos mapaches" width="400">
            </section>

            <section>
                <h3>Extensiones populares de Django</h3>
            
                <ul>
                    <li><a target="_blank" href="https://django-debug-toolbar.readthedocs.io/en/latest/">Django Debug Toolbar</a> para depuraci√≥n
                    <li><a target="_blank" href="https://django-crispy-forms.readthedocs.io/en/latest/">Django Crispy Forms</a> para estilizar formularios
                    <li><a target="_blank" href="https://django-allauth.readthedocs.io/en/latest/">Django Allauth</a> para autenticaci√≥n
                    <li><a target="_blank" href="https://pypi.org/project/django-storages/">Django Storages</a> para almacenamiento en la nube
                    <li><a target="_blank" href="https://pypi.org/project/django-honeypot/">Django Honeypot</a> para prevenci√≥n de spam
                </ul>
            
                <p>üîó Lee m√°s: <a target="_blank" href="https://learndjango.com/tutorials/20-django-packages-i-use-every-project">
                    20 paquetes de Django que uso en cada proyecto</a></p>
            </section>

            <section class="heading-only"  data-background-image="background_headingonly.png">
                <h2>Aplicaciones Django<br>
                    en Producci√≥n</h2>

                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_PYTHON.svg" alt="Bit (el mapache) frente a una computadora y el logotipo de Python" width="400">
            </section>
            
            <section>
                <h3>Ejecutando la aplicaci√≥n Django localmente</h3>

                <p>Usando el servidor integrado de Django:</p>
                <pre style="font-size:0.9em;"><code data-trim data-noescape class="bash">
                python3 -m src/manage.py runserver 8000
                </code></pre>

                <p>‚ö†Ô∏è Pero el servidor de desarrollo no se recomienda para uso en producci√≥n.</p>

            </section>

            <section>
                <h3>Ejecutando Django con gunicorn</h3>

                <p>Gunicorn es un servidor de nivel de producci√≥n
                    que puede ejecutar m√∫ltiples procesos de trabajo.</p>

                <p>Agrega <code>gunicorn</code> a <code>requirements.txt</code>:</p>
                <pre style="font-size:0.7em; margin-top:0px;"><code data-trim data-noescape class="shell">
                gunicorn==22.0.0
                </code></pre>

                <p class="padded">Usa <code>gunicorn</code> para ejecutar la aplicaci√≥n Django con m√∫ltiples procesos de trabajo:</p>
                <pre style="font-size:0.7em; margin-top:0px;"><code data-trim data-noescape class="shell">
                python3 -m gunicorn project.wsgi --workers 4 --bind 0.0.0.0:8555
                </code></pre>
            </section>

            <section>
                <h3>Configurando gunicorn</h3>

                <p>Gunicorn se puede configurar con un archivo <code>gunicorn.conf.py</code>:</p>

                <pre style="font-size:0.7em; margin-top:0px;"><code data-trim data-noescape class="python">
                import multiprocessing

                max_requests = 1000
                max_requests_jitter = 50
                log_file = "-"
                bind = "0.0.0.0:8000"
                workers = (multiprocessing.cpu_count() * 2) + 1
                
                threads = workers
                
                timeout = 600
                </code></pre>

                <p>El comando de ejecuci√≥n se puede simplificar a:</p>
                <pre style="font-size:0.7em; margin-top:0px;"><code data-trim data-noescape class="shell">
                python3 -m gunicorn project.wsgi
                </code></pre>

            </section>

            <section class="heading-only">
                <h2>Alojamiento de Django</h2>
                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_AZURE.png" alt="Bit (el mapache) en una nube con el logotipo de Azure" width="400">

            </section>


            <section>
                <h3>Opciones de alojamiento de aplicaciones en Azure</h3>
            
                <ul>
                    <li style="line-height:1.0em;">¬øCu√°nto control deseas tener?
                    <li style="line-height:1.0em;">¬øCu√°nto disfrutas administrar sistemas?
                    <li style="line-height:1.0em;">¬øNecesitas que la aplicaci√≥n pueda escalar vertical u horizontalmente?
                </ul>

                <style>
                table.deploy-stack {
                    border-spacing: 30px; 
                    border-collapse: separate;
                    border: 0px;
                }

                table.deploy-stack th, table.deploy-stack td {
                    font-size: 20px;
                    border-bottom: 0px none;
                    border-radius: 12px;
                    text-align: center;
                    vertical-align: middle;
                    padding: 8px;
                }
                </style>
                <table class="deploy-stack">
                    <tr>
                        <th>
                        <td>
                        <td style="background-color: #00bc70; color: white;">Azure Container Apps
                        <td>
                        <td style="background-color: #00bc70; color: white;">Azure Functions
                    </tr> 
                    <tr>
                        <th>
                        <td style="background-color: #00bc70; color: white;">Azure Kubernetes Service
                        <td style="background-color: #0070c0; color: white;">Administraci√≥n de contenedores
                        <td style="background-color: #00bc70; color: white;">Azure App Service
                        <td style="background-color: #0070c0; color: white;">Serverless
                        
                    </tr>
                    <tr>
                        <th>Entorno
                        <td colspan="2" style="background-color:#0070c0; color: white;">Contenedores
                        <td colspan="2" style="background-color:#0070c0; color: white;">PaaS
                    </tr>
                    <tr>
                        <th>Nube
                        <td colspan="4" style="background-color:#ccc;">Azure
                    </tr>
                </table>
                <p class="fragment smaller">Para Django, la forma m√°s sencilla de comenzar es utilizar <span style="background-color: #00bc70; color: white; padding-left: 8px; padding-right: 8px; border-radius: 8px;">App Service</span>.</p>
            </section>

            <section>
                <h3>Opciones de base de datos relacional en Azure</h3>

                <p>Consideraciones:
                <ul>
                    <li style="line-height:1.0em;">¬øCu√°nto almacenamiento de base de datos necesitas?
                    <li style="line-height:1.0em;">¬øCu√°ntas lecturas/escrituras de base de datos esperas?
                    <li style="line-height:1.0em;">Disponibilidad: ¬øPol√≠tica de respaldo? ¬øM√∫ltiples r√©plicas?
                    <li style="line-height:1.0em;">Soberan√≠a de datos: ¬øD√≥nde se puede almacenar tus datos?
                </ul>

                <style>
                .fragment.background-green {
                    background-color: transparent;
                }
                .fragment.background-green.visible {
                    background-color: #31ffad;
                }
                </style>

                <table class="smaller" style="margin-top:20px;">
                    <thead>
                        <tr>
                            <th>Opci√≥n</th>
                            <th>Descripci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="fragment custom background-green">
                            <td>Azure Database for PostgreSQL - Flexible Server</td>
                            <td>La oferta m√°s reciente de Microsoft para PostgreSQL. Servicio completamente administrado con escalado vertical.
                            </td>
                        </tr>
                        <tr>
                          <td>Azure Cosmos DB para PostgreSQL</td>
                          <td>Base de datos distribuida que utiliza PostgreSQL y la extensi√≥n Citus. Puede escalar horizontalmente.
                          </td>
                        <tr>
                            <td>Azure SQL Database</td>
                            <td>Servicio administrado de Microsoft para SQL Server.
                                Se puede utilizar en Django a trav√©s de <a target="_blank" href="https://github.com/microsoft/mssql-django">microsoft/mssql-django</a>
                      </tr>
                    </tbody>
                </table>

            </section>

            <section>
                <h3>Conexi√≥n segura de App Service a PostgreSQL</h3>

                <p>‚≠êÔ∏è En producci√≥n, utiliza autenticaci√≥n sin contrase√±a para la base de datos:</p>

                <ol>
                    <li style="line-height:1.0em;">Deshabilita la autenticaci√≥n por contrase√±a en PostgreSQL
                    <li style="line-height:1.0em;">Establece el usuario de Microsoft Entra como administrador de PostgreSQL
                    <li style="line-height:1.0em;">Crea un service principal para la aplicaci√≥n de App Service y ot√≥rgale acceso a la base de datos
                    <li style="line-height:1.0em;">Obt√©n un token como la aplicaci√≥n y √∫salo como contrase√±a de conexi√≥n a PostgreSQL
                    <li style="line-height:1.0em;">Obt√©n peri√≥dicamente un nuevo token para evitar la expiraci√≥n
                </ol>
                <p>Consulta <a target="_blank" class="smaller aka" href="https://aka.ms/django-quiz-app">aka.ms/django-quiz-app</a></p>

                <p class="padded fragment">‚ö†Ô∏è Si es necesario utilizar una contrase√±a, almac√©nala en Azure KeyVault.<br>
                    Consulta <a target="_blank" class="smaller aka" href="https://aka.ms/django-quiz-app">aka.ms/django-quiz-app</a></p>
                </p>
            </section>

            <section>
                <h3>Almacenamiento de la clave secreta</h3>

                <p>Django requiere una clave secreta para la seguridad, definida en <code>settings.py</code>:</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="python">
                SECRET_KEY = os.environ.get("SECRET_KEY")
                </code></pre>
                
                <div class="fragment">
                <p class="padded">Para producci√≥n, almacena esto en un lugar seguro,
                    como Azure Key Vault. üîë</p>

                <p class="padded">Para obtener el valor secreto, utiliza una referencia de Azure Key Vault en las variables de entorno:</p>

                <pre style="font-size:0.8em; margin-top: 0px;"><code data-trim data-noescape class="shell">
                SECRET_KEY: '@Microsoft.KeyVault(VaultName=${keyVaultName};SecretName=djangoSecretKey)'
                </code></pre>

                <p>(Tambi√©n es posible en <a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca/blob/main/infra/web.bicep#L84">Configuraci√≥n de la aplicaci√≥n de contenedor</a>)</p>
                </div>

            </section>


            <section>
                <h3>Servir archivos est√°ticos</h3>

                <p>Algunas opciones para servir archivos est√°ticos de manera eficiente en producci√≥n:</p>

                <ol>
                    <li>Usar <a target="_blank" href="https://whitenoise.readthedocs.io/en/latest/">Whitenoise</a>
                        para servir archivos est√°ticos directamente desde Django, con compresi√≥n y encabezados de cach√©.
                        <p>Como se muestra en <a target="_blank" href="https://aka.ms/django-quiz-app">aka.ms/django-quiz-app</a>.</p>
                    <li>Usar <a target="_blank" href="https://pypi.org/project/django-storages/">Django Storages</a>
                        para servir archivos est√°ticos desde almacenamiento en la nube (como Azure Blob Storage).
                        <p>Como se muestra en <a target="_blank" href="https://github.com/tonybaloney/django-on-azure">tonybaloney/django-on-azure</a>.</p>
                </ol>

                <p>Ambas opciones podr√≠an ser utilizadas opcionalmente con un CDN (Azure Front Door) al frente.</p>
            </section>

            <section>
                <h3>Arquitectura de Azure para Django + PostgreSQL</h3>

                <p>Una posible arquitectura:<br>
                <img src="architecture.png" alt="Diagrama de arquitectura de la aplicaci√≥n Django: App Service, App Service Plan, servidor PostGreSQL, espacio de trabajo de Log Analytics" style="width: 700px;">
                </p>

            </section>

            <section>
                <h3>Ejercicio: Implementar Django + PG</h3>

                <p>Usando este repositorio:<br>
                    <a  target="_blank" class="smaller" href="https://github.com/pamelafox/django-quiz-app">github.com/pamelafox/django-quiz-app</a>
                    <br>
                    <a target="_blank" class="smaller aka" href="https://aka.ms/django-quiz-app">aka.ms/django-quiz-app</a>
                </p>

                <ol>
                    <li>Abre en GitHub Codespaces o en VS Code con la extensi√≥n Dev Containers.
                    <li>Reg√≠strate en una <a target="_blank" href="https://azure.microsoft.com/free/">cuenta gratuita de Azure</a>.
                    <li>Sigue las instrucciones de implementaci√≥n en el archivo README.
                    <li>Si se implementa correctamente, visita la URL del punto de conexi√≥n para confirmar que funciona.
                    <li>Ejecuta <code>azd down</code> para desimplementar la aplicaci√≥n (para no desperdiciar recursos en la nube innecesariamente).
                </ol>
            </section>


            <section>
                <h3>Consideraciones adicionales de seguridad</h3>
                <p>Restringir el acceso a la red:</p>
                <ul class="smaller">
                    <li>‚≠êÔ∏è Coloca la base de datos y la aplicaci√≥n en la misma red virtual<br>
                        Consulta <a target="_blank" class="smaller aka" href="https://github.com/Azure-Samples/msdocs-django-postgresql-sample-app">https://aka.ms/django-restaurants</a>
                    <li>Si no puedes usar una red virtual, utiliza un firewall para restringir el acceso a la base de datos<br>
                        Consulta <a target="_blank" class="smaller aka" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-appservice">aka.ms/django-pgflex-app</a>
                        <br>
                        ‚ö†Ô∏è El firewall a√∫n permite el acceso desde otras aplicaciones alojadas en Azure.
                </ul>

                <p>Dificulta el acceso al administrador:</p>

                <ul class="smaller">
                    <li>Personaliza la URL del administrador
                        <pre><code data-trim data-noescape class="python">
                        ADMIN_URL = os.environ.get("ADMIN_URL")
                        </code></pre>
                    <li>Utiliza <a target="_blank" href="https://pypi.org/project/django-admin-honeypot/">django-admin-honeypot</a> para detectar accesos no autorizados
                </ul>
            </section>

            <section>
                <h3>Plantillas de Django en Azure</h3>

                <ul>
                    <li>Todas las variantes de la aplicaci√≥n de turismo espacial:
                        <ul>
                            <li><a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-appservice">Django Postgres - Azure App Service con servidor flexible</a>
                            <li><a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-flexible-aca">Django Postgres - Azure Container Apps con servidor flexible</a>
                            <li><a target="_blank" href="https://github.com/Azure-Samples/azure-django-cosmos-postgres-appservice">Django CosmosDB Postgres Adapter - Azure App Service</a>
                            <li><a target="_blank" href="https://github.com/Azure-Samples/azure-django-cosmos-postgres-aca">Django CosmosDB Postgres Adapter - Azure Container Apps</a>
                            <li><a target="_blank" href="https://github.com/Azure-Samples/azure-django-postgres-addon-aca">Django Azure Container Apps Postgres Addon - Azure Container Apps</a>
                        </ul>
                    <li>+ Almacenamiento: <a target="_blank" href="https://github.com/tonybaloney/django-on-azure">github.com/tonybaloney/django-on-azure</a>
                    <li>+ VNet: <a target="_blank" href="https://github.com/Azure-samples/msdocs-django-postgresql-sample-app">github.com/Azure-samples/msdocs-django-postgresql-sample-app</a>
                    <li>+ Redis: <a target="_blank" href="https://github.com/pamelafox/cookiecutter-django-azure">github.com/pamelafox/cookiecutter-django-azure</a>
                </ul>

                <p>Tambi√©n puedes consultar el <a target="_blank" href="https://docs.djangoproject.com/en/4.2/intro/tutorial01/">tutorial de Django</a>.</p>
            </section>

            <section>
                <h3>M√°s recursos de Azure</h3>

                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_COWORKING.png" alt="Mapaches con laptops" width="35%" style="float:right;">

                <ul style="float:left; width: 60%; display: grid; gap: 18px;">
                    <li><a target="_blank" href="https://learn.microsoft.com/es-es/azure/app-service/quickstart-python?WT.mc_id=python-81211-pamelafox">Implementar una aplicaci√≥n web Python (Django o Flask) en Azure App Service</a>
                    <li><a target="_blank" href="https://learn.microsoft.com/es-es/azure/app-service/tutorial-python-postgresql-app?WT.mc_id=python-81211-pamelafox">Implementar una aplicaci√≥n web Python (Django o Flask) con PostgreSQL en Azure</a>
                    <li><a target="_blank" href="https://learn.microsoft.com/es-es/azure/developer/python/quickstarts-app-hosting?WT.mc_id=python-81211-pamelafox">Hospedar aplicaciones Python en Azure</a>
                    <li><a target="_blank" href="https://code.visualstudio.com/docs/python/python-tutorial">Primeros pasos con Python en VS Code</a>
                    <li><a target="_blank" href="https://aka.ms/python-discord">MS Python Discord: aka.ms/python-discord</a>
                </ul>
            </section>

            <section class="heading-only">
                <h2>¬øAlguna pregunta?</h2>
                <img src="https://pamelafox.github.io/python-web-apps/static/images/BIT_STUDENTS.svg" alt="A bunch of raccoon students with computers" width="400">
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.1.0/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.1.0/plugin/highlight/highlight.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-badge@0.1.9/highlightjs-badge.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-menu@2.1.0/menu.js"></script>
    <script>
        Reveal.initialize({
            width: 1280,
            height: 720,
            hash: true,
            center: false,
            slideNumber: true,
            showNotes: false,
            margin: 0.1,
            preloadIframes: true,
            autoPlayMedia: true,
            plugins: [ RevealHighlight, RevealMenu ],
            pdfSeparateFragments: true
        });
        window.highlightJsBadge();

    </script>
    </body>
</html>